<!DOCTYPE html>
<!--<html manifest="cache.manifest">-->
<html>
<head>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-24502736-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-24502736-2');
</script>
  <title>GABC Transcription Tool</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <meta name="color-scheme" content="light dark">
  <link rel="icon" href="icon/clear-main.png" type="image/png" />
  <link rel="chrome-webstore-item" href="https://chrome.google.com/webstore/detail/mkhgaijffgijgkolifpoaijimncdakkd" />
  <link rel="stylesheet" type="text/css" href="css/smoothness/jquery-ui-1.10.3.custom.min.css" />
  <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="style.css" />
  <link rel="stylesheet" type="text/css" href="modern.css" />
  <link rel="stylesheet" type="text/css" href="navbar.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="jquery.min.js" type="text/javascript"></script>
  <script src="jquery-ui-1.10.3.custom.min.js" type="text/javascript"></script>
  <script src="js/Tone.min.js"></script>
  <script src="js/tones.js"></script>
  <script src="util.js" type="text/javascript"></script>
  <script src="psalmtone.js"></script>
  <script src="jquery.hypher.js"></script>
  <script src="patterns/pl.js"></script>
  <script src="patterns/en-us.js"></script>
  <script src="patterns/la-hypher.js"></script>
  <script src="transcriber.html.js"></script>
  <script src="js/theme.js"></script>
  <script src="js/burgermenu.js"></script>
  <!-- <script src="../exsurge/dist/exsurge.js"></script> -->
  <script src="exsurge.min.js"></script>
  <script src="saveSvgAsPng.js"></script>
  <script>
  Hypher.languages.en.leftMin = 1;
  Hypher.languages.en.rightMin = 1;
  Hypher.languages.pl.leftMin = 1;
  Hypher.languages.pl.rightMin = 1;
  </script>
<style>
/* Styles de base */
textarea {
  padding: 8px;
  resize: none;
  width: 100%;
  border-radius: var(--border-radius);
  border: 1px solid var(--border-color);
  background-color: var(--background-color);
  color: var(--text-color);
  font-size: 16px;
  line-height: 1.5;
  transition: border-color 0.2s, box-shadow 0.2s;
}

textarea:focus {
  outline: none;
  border-color: var(--accent-color);
  box-shadow: 0 0 0 2px rgba(139, 0, 0, 0.2);
}

/* Conteneur principal avec marges */
.main-container {
  max-width: 100%;
  width: 100%;
  margin: 0 auto;
  padding: 0 10px;
}

@media(min-width: 624px) {
  .main-container {
    max-width: 600px;
    padding: 0 12px;
  }
}

@media(min-width: 1262px) {
  .main-container {
    max-width: 1240px;
    padding: 0 20px;
  }
}

/* Barre de navigation avec la même largeur que dans propers */
.container-wrapper {
  width: 100%;
  display: flex;
  justify-content: center;
  background-color: var(--navbar-bg);
  border-bottom: 1px solid var(--border-color);
  position: sticky;
  top: 0;
  z-index: 1000;
}

.navbar-card.hide-print.ss-border-bottom {
  max-width: 100%;
  width: 100%;
  margin: 0 auto;
  padding: 10px;
  border-bottom: none !important;
}

@media(min-width: 624px) {
  .navbar-card.hide-print.ss-border-bottom {
    max-width: 600px;
    padding: 10px 12px;
  }
}

@media(min-width: 1262px) {
  .navbar-card.hide-print.ss-border-bottom {
    max-width: 1240px;
    padding: 10px 20px;
  }
}

/* Conteneur des zones d'édition */
.editor-container {
  display: flex;
  flex-direction: column;
  gap: 16px;
  width: 100%;
  max-width: 100%;
  margin: 0 auto 16px;
}

.editor-row {
  display: flex;
  gap: 16px;
  flex-wrap: wrap;
  width: 100%;
}

.editor-column {
  flex: 1;
  min-width: 300px;
}

.editor-labels {
  display: flex;
  width: 100%;
  justify-content: space-between;
  margin-bottom: 12px;
}

.editor-labels-column {
  flex: 1;
  min-width: 300px;
}

.editor-labels-column label {
  font-size: 18px;
  font-weight: bold;
  display: block;
  margin-bottom: 5px;
}

.editor-column-header {
  display: flex;
  flex-direction: column;
  margin-bottom: 12px;
}

.editor-column-header > label {
  font-size: 18px;
  font-weight: bold;
  margin-bottom: 5px;
}

/* Contrôles inline */
.inline-controls {
  display: flex;
  width: 100%;
  justify-content: space-between;
  align-items: center;
  margin: 10px 0;
  flex-wrap: nowrap;
  height: 32px;
}

.left-control {
  display: flex;
  align-items: center;
  white-space: nowrap;
  height: 100%;
}

.right-control {
  display: flex;
  justify-content: flex-end;
  height: 100%;
}

.right-control select {
  height: 32px;
  font-size: 15px;
  border-radius: var(--border-radius);
  border: 1px solid var(--border-color);
  background-color: var(--background-color);
  color: var(--text-color);
  padding: 2px 8px;
  min-width: 130px;
}

/* Style pour les cases à cocher */
input[type="checkbox"] {
  margin-right: 8px;
  vertical-align: middle;
  transform: scale(1.2);
  margin-top: 0;
  margin-bottom: 0;
}

/* Labels */
label {
  font-size: 16px;
  margin-bottom: 0;
  font-weight: normal;
}

/* Preview du chant */
#chant-parent2 {
  width: 100%;
  max-width: 100%;
  margin: auto;
  height: 60vh;
  transition: height 0.3s ease;
}

#chant-parent {
  border: 1px solid var(--border-color);
  border-radius: var(--border-radius);
  background-color: var(--card-bg);
  overflow-y: auto;
  height: 100%;
  box-shadow: var(--box-shadow);
}

#chant-pad {
  padding: 16px;
}

#chant-preview {
  margin: 0 auto;
  max-width: 100%;
  overflow-x: auto;
}

/* Contrôles et actions */
.action-buttons {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin: 1rem 0;
  justify-content: center;
}

.action-buttons a {
  display: inline-block;
  padding: 8px 12px;
  background-color: var(--button-bg);
  color: var(--text-color);
  text-decoration: none;
  border-radius: var(--border-radius);
  border: 1px solid var(--border-color);
  transition: all 0.2s ease;
  text-align: center;
}

.action-buttons a:hover {
  background-color: var(--button-hover-bg);
  color: var(--accent-color);
}

/* Option de mode intégré */
.toggle-mode {
  text-align: center;
  margin: 1rem 0;
}

/* Mode sombre spécifique */
:root[data-theme="dark"] #chant-parent {
  border-color: var(--border-color);
  background-color: var(--card-bg);
}

:root[data-theme="dark"] textarea {
  background-color: var(--button-bg);
  color: var(--text-color);
  border-color: var(--border-color);
}

:root[data-theme="dark"] .action-buttons a {
  background-color: var(--button-bg);
  color: var(--text-color);
  border-color: var(--border-color);
}

:root[data-theme="dark"] .action-buttons a:hover {
  background-color: var(--button-hover-bg);
  color: var(--accent-color);
}

:root[data-theme="dark"] .right-control select {
  background-color: var(--button-bg);
  color: var(--text-color);
  border-color: var(--border-color);
}

/* État du corps avec menu ouvert */
body.menu-open {
  overflow: hidden;
  position: fixed;
  width: 100%;
  height: 100%;
}

/* Media queries pour la responsivité */
@media screen and (max-width: 768px) {
  .main-container {
    padding: 0 10px;
  }
  
  body {
    padding-top: 0; /* Plus besoin car nous utilisons position: sticky */
  }
  
  .container-wrapper {
    position: sticky; /* Conserver sticky même sur mobile */
  }
  
  .navbar-card.hide-print.ss-border-bottom {
    padding: 10px;
  }
  
  .editor-labels {
    flex-direction: column;
  }
  
  .editor-labels-column {
    margin-bottom: 8px;
  }
  
  #chant-parent2 {
    height: 50vh;
  }
  
  .editor-column {
    min-width: 100%;
  }
  
  textarea {
    height: 180px !important;
  }
  
  .action-buttons {
    flex-direction: column;
  }
  
  .action-buttons a {
    width: 100%;
  }
  
  /* Amélioration de la navigation mobile */
  .nav-pills.show {
    box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15);
    max-height: calc(100vh - 56px);
    overflow-y: auto;
  }
  
  /* Amélioration de l'apparence des boutons */
  .btn-xs {
    padding: 6px 10px !important;
    font-size: 14px !important;
  }
  
  /* Rendre le bouton burger plus visible */
  .burger-menu {
    padding: 10px;
  }
  
  .burger-menu .fa {
    font-size: 22px;
  }
}

@media print {
  #chant-parent2,
  #chant-parent {
      border: 0;
      overflow-y: visible;
    height: auto;
  }
  
  .hide-print {
    display: none !important;
  }
}
</style>
</head>
<body class='sans'>
<form id="pdfForm" target="_blank" method="get" action="https://www.sourceandsummit.com/editor/legacy/">
  <!--<input type='hidden' name='pdf' value='1'/>-->
  <input type='hidden' name='crop' value='0'/>
</form>
<form id="pdfFormDirect" target="_blank" method="post" action="https://www.sourceandsummit.com/editor/legacy/process.php">
  <input type="hidden" id="pdff_gabc" name="gabc[]"/>
  <input type="hidden" id="pdff_width" name="width" value="7.5"/>
  <input type="hidden" id="pdff_height" name="height" value="11"/>
  <input type="hidden" id="pdff_croppdf" name="croppdf" value="false"/>
  <input type="hidden" id="pdff_spacing" value="vichi" name="spacing"/>
  <input type="hidden" id="pdff_font" value="GaramondPremierPro" name="font"/>
  <input type="hidden" id="pdff_fontsize" value="20" name="fontsize"/>
  <input type="hidden" id="pdff_fmt" name="fmt" value="pdf"/>
</form>

<!-- Wrapper pour centrer la navigation -->
<div class="container-wrapper">
  <!-- Navigation Bar -->
<div class="card navbar-card hide-print ss-border-bottom">
  <ul class="nav nav-pills" style="display: inline-block;">
    <li role="presentation" class="active"><a href="transcriber.html">GABC Transcription Tool</a></li>
    <li role="presentation"><a href="psalmtone.html">Psalm Tone Tool</a></li>
    <li role="presentation"><a href="readings.html">Readings Tool</a></li>
    <li role="presentation"><a href="propers.html">Propers Tool</a></li>
    <li role="presentation"><a href="faq.html">(About)</a></li>
  </ul>
  <div style="float:right;margin-left:8px" class="btn-group shadow" role="group">
    <button class="theme-toggle btn btn-xs" style="margin-right: 8px;" onclick="toggleTheme()" title="Changer de thème"><i class="fa fa-moon-o" aria-hidden="true"></i></button>
    <a class='btn btn-xs btn-primary rounded' href='#' id='lnkPdfDirect'>PDF</a>
    <a class='btn btn-xs btn-default rounded' href='#' id='lnkPdf'>Further PDF options</a>
  </div>
  <div class="burger-menu">
    <i class="fa fa-bars" aria-hidden="true"></i>
  </div>
</div>
</div>

<!-- Contenu principal avec marges -->
<div class="main-container">
  <!-- Toggle Mode Button -->
  <div class="toggle-mode hide-print">
    <a href="#" id="lnkToggleMode" class="btn btn-xs btn-default">Show integrated GABC</a>
  </div>

  <!-- Editor Containers -->
  <div class="hide-print">
    <!-- Two Boxes Mode (Default) -->
    <div id="twoBoxes" class="editor-container">
      <!-- En-têtes Text et GABC alignés sur la même ligne -->
      <div class="editor-labels">
        <div class="editor-labels-column">
          <label for="hymntext" title="This text box is for the text of the chant. Select a different language from the dropdown to the right to change the syllabification behavior.">Text</label>
        </div>
        <div class="editor-labels-column">
          <label for="hymngabc" title="This text box is for the GABC notation that would normally be in parentheses, as well as the GABC header.">GABC</label>
        </div>
      </div>
      
      <div class="editor-row">
        <!-- Text Editor -->
        <div class="editor-column">
          <div class="editor-column-header">
            <div class="inline-controls">
              <div class="left-control">
                <input type="checkbox" id="cbElisionHasNote" style="margin-right: 5px; vertical-align: middle;"/>
                <label for="cbElisionHasNote" title="You can signify an elision in the text by putting a vowel in parentheses. If this box is checked, the elision will still have a punctum associated with it; if this is unchecked, that syllable will have no punctum.">Use puncta for elisions</label>
              </div>
              <div class="right-control">
                <select id="selLanguage" title="If you select English, the text will be run through the lyric hyphenator at juiciobrennan.com; it will only contact this site at most once every 5 seconds so you may have to wait a bit at times for the word syllabification to correct itself. Custom syllable breaks may be entered using = as in 'syl=la=ble'">
  <option value="la">Latin</option>
  <option value="la-liturgical">Liturgical Latin</option>
  <option value="en">English</option>
  <option value="pl">Polish</option>
  <option value="vi">Vietnamese</option>
  <option value="zh">Chinese</option>
</select>
              </div>
            </div>
          </div>
          <textarea id="hymntext" lang="la" style="height: 250px;">Adoro t(e) devote, latens Deitas,&#10;Quæ sub his figuris vere latitas;&#10;Tibi se cor meum totum subjicit,&#10;Quia te contemplans totum deficit.&#10;2. Visus, tactus, gustus in te fallitur,&#10;Sed auditu solo tuto creditur.&#10;Credo quidquid dixit Dei Filius;&#10;Nil hoc verbo veritátis verius.&#10;--&#10;Amen.</textarea>
        </div>
        
        <!-- GABC Editor -->
        <div class="editor-column">
          <div class="editor-column-header">
            <div class="inline-controls">
              <div class="left-control">
                <input type='checkbox' id='cbMultipleVerses'/> 
                <label for="cbMultipleVerses">All verses to one line of chant</label>
              </div>
              <div class="right-control">
                <!-- Espace réservé pour maintenir l'alignement -->
              </div>
            </div>
          </div>
          <textarea id="hymngabc" spellcheck="false" style="height: 250px;">c4 c e g g gh g. , f e d c c. ;&#10;c e g g gh g. , f e d c c. :&#10;g g hi j ji g. , h g f e d. ;&#10;e g f e dc d. , e c d c c. ::&#10;--&#10;cdc bc.. ::</textarea>
        </div>
</div>
</div>
    
    <!-- One Box Mode (Integrated GABC) -->
    <div id="oneBox" style="display:none;" class="editor-container">
      <div class="editor-labels">
        <div class="editor-labels-column" style="flex: 1;">
          <label for="editor" title="You can put GABC headers in this text box if you want them included in the GABC file download link below. Any headers you type in will persist in local storage between sessions.">Integrated GABC</label>
        </div>
      </div>
      <div class="editor-column" style="width: 100%;">
        <textarea id="editor" spellcheck="false" style="height: 400px;"></textarea>
      </div>
</div>
    
    <!-- Action Buttons -->
    <div class="action-buttons">
      <a href="#" id="lnkDownloadGabc" draggable target="_blank">Download Integrated GABC</a>
      <a href="#" id="lnkDownloadPng">Download PNG</a>
  <a href="#" id="lnkDownloadSvg">Download SVG</a>
</div>
</div>

  <!-- Chant Preview -->
<div id="chant-parent2">
  <div id="chant-parent">
    <div id="chant-pad">
      <div id="chant-preview" class="clickable"></div>
    </div>
  </div>
</div>
</div>

<!-- SVG Filters -->
  <svg class="bg-blur">
  <defs>
    <filter id="text-glow" x="-100%" y="-100%" width="300%" height="300%">
      <feGaussianBlur in="SourceAlpha" stdDeviation="5 5" result="glow"/>
      <feFlood flood-color="#337ab7" result="COLOR" />
      <feComposite in="COLOR" in2="glow" operator="in" result="glow-color" />
      <feMerge>
        <feMergeNode in="glow-color"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
    <filter id="note-glow" x="-150%" y="-150%" width="400%" height="400%">
      <feGaussianBlur in="SourceAlpha" stdDeviation="5 5" result="glow"/>
      <feFlood flood-color="#337ab7" result="COLOR" />
      <feComposite in="COLOR" in2="glow" operator="in" result="glow-color" />
      <feMerge>
        <feMergeNode in="glow-color"/>
        <feMergeNode in="glow-color"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
  </defs>
  </svg>

<script>
  // Script personnalisé pour améliorer la gestion des modes et la responsivité
  $(document).ready(function() {
    // Gestion de la transition entre les modes (two boxes vs integrated GABC)
    $("#lnkToggleMode").click(function(e) {
      e.preventDefault();
      $(this).text($("#oneBox").is(':hidden') ? "Show split view" : "Show integrated GABC");
      $("#oneBox,#twoBoxes").fadeToggle();
      
      // Ajuster les hauteurs après le changement de mode
      if (typeof adjustEditorHeights === 'function') {
        adjustEditorHeights();
      }
    });
    
    // S'assurer que l'aperçu est adapté à la taille de l'écran
    function adjustPreviewSize() {
      const chantPreview = document.getElementById('chant-preview');
      if (chantPreview) {
        // S'assurer que le contenu ne dépasse pas la largeur de l'écran
        if (window.innerWidth < 768) {
          const previewWidth = chantPreview.getBoundingClientRect().width;
          const scale = window.innerWidth / (previewWidth + 32); // 32px pour les marges
          
          if (scale < 1) {
            chantPreview.style.transform = `scale(${scale})`;
            chantPreview.style.transformOrigin = 'left top';
          } else {
            chantPreview.style.transform = 'none';
          }
        } else {
          chantPreview.style.transform = 'none';
        }
      }
    }
    
    // Exécuter l'ajustement au chargement et lors du redimensionnement
    $(window).resize(adjustPreviewSize);
    adjustPreviewSize();
    
    // Améliorer l'expérience de défilement dans le conteneur de l'aperçu
    $("#chant-parent").on('wheel', function(e) {
      if (e.originalEvent.deltaY !== 0) {
        e.preventDefault();
        this.scrollTop += e.originalEvent.deltaY;
      }
    });
  });
</script>
</body>
</html>
